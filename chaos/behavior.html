<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Behavior chaos strategy | Polly </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Behavior chaos strategy | Polly ">
      
      
      <link rel="icon" href="../icon.png">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/App-vNext/Polly/blob/main/docs/chaos/behavior.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../icon.png" alt="Polly">
            Polly
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="behavior-chaos-strategy">Behavior chaos strategy</h1>

<h2 id="about">About</h2>
<ul>
<li><strong>Options</strong>: <a class="xref" href="../api/Polly.Simmy.Behavior.BehaviorStrategyOptions.html"><code>BehaviorStrategyOptions</code></a></li>
<li><strong>Extensions</strong>: <code>AddChaosBehavior</code></li>
<li><strong>Strategy Type</strong>: Proactive</li>
</ul>
<hr>
<p>The behavior chaos strategy is designed to inject custom behaviors into system operations right before such an operation is invoked. This strategy is flexible, allowing users to define specific behaviors such as altering the input, simulating resource exhaustion, putting the system in a given state before the actual operation is called, or other operational variations to simulate real-world scenarios.</p>
<h2 id="usage">Usage</h2>
<!-- snippet: chaos-behavior-usage -->
<pre><code class="lang-cs">// To use a custom function to generate the behavior to inject.
var optionsWithBehaviorGenerator = new BehaviorStrategyOptions
{
    BehaviorAction = static args =&gt; RestartRedisVM(),
    Enabled = true,
    InjectionRate = 0.05
};

// To get notifications when a behavior is injected
var optionsOnBehaviorInjected = new BehaviorStrategyOptions
{
    BehaviorAction = static args =&gt; RestartRedisVM(),
    Enabled = true,
    InjectionRate = 0.05,
    OnBehaviorInjected = static args =&gt;
    {
        Console.WriteLine(&quot;OnBehaviorInjected, Operation: {0}.&quot;, args.Context.OperationKey);
        return default;
    }
};

// Add a behavior strategy with a BehaviorStrategyOptions instance to the pipeline
new ResiliencePipelineBuilder().AddChaosBehavior(optionsWithBehaviorGenerator);
new ResiliencePipelineBuilder&lt;HttpResponseMessage&gt;().AddChaosBehavior(optionsOnBehaviorInjected);

// There are also a handy overload to inject the chaos easily.
new ResiliencePipelineBuilder().AddChaosBehavior(0.05, RestartRedisVM);
</code></pre>
<!-- endSnippet -->
<p>Example execution:</p>
<!-- snippet: chaos-behavior-execution -->
<pre><code class="lang-cs">var pipeline = new ResiliencePipelineBuilder()
    .AddRetry(new RetryStrategyOptions
    {
        ShouldHandle = new PredicateBuilder().Handle&lt;RedisConnectionException&gt;(),
        BackoffType = DelayBackoffType.Exponential,
        UseJitter = true,  // Adds a random factor to the delay
        MaxRetryAttempts = 4,
        Delay = TimeSpan.FromSeconds(3),
    })
    .AddChaosBehavior(new BehaviorStrategyOptions // Chaos strategies are usually placed as the last ones in the pipeline
    {
        BehaviorAction = static args =&gt; RestartRedisVM(),
        Enabled = true,
        InjectionRate = 0.05
    })
    .Build();
</code></pre>
<!-- endSnippet -->
<h2 id="defaults">Defaults</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OnBehaviorInjected</code></td>
<td><code>null</code></td>
<td>Action executed when the behavior is injected.</td>
</tr>
<tr>
<td><code>BehaviorAction</code></td>
<td><code>null</code></td>
<td>Custom behavior to be injected.</td>
</tr>
</tbody>
</table>
<h2 id="diagrams">Diagrams</h2>
<h3 id="normal--sequence-diagram">Normal 🐵 sequence diagram</h3>
<pre><code class="lang-mermaid">sequenceDiagram
    actor C as Caller
    participant P as Pipeline
    participant B as Behavior
    participant D as DecoratedUserCallback

    C-&gt;&gt;P: Calls ExecuteAsync
    P-&gt;&gt;B: Calls ExecuteCore
    activate B
    B--&gt;&gt;B: Determines Injection&lt;br/&gt;Decision: 🐵
    deactivate B
    B-&gt;&gt;+D: Invokes
    D-&gt;&gt;-B: Returns result
    B-&gt;&gt;P: Returns result
    P-&gt;&gt;C: Returns result
</code></pre>
<h3 id="chaos--sequence-diagram">Chaos 🙈 sequence diagram</h3>
<pre><code class="lang-mermaid">sequenceDiagram
    actor C as Caller
    participant P as Pipeline
    participant B as Behavior
    participant D as DecoratedUserCallback

    C-&gt;&gt;P: Calls ExecuteAsync
    P-&gt;&gt;B: Calls ExecuteCore
    activate B
    B--&gt;&gt;B: Determines Injection&lt;br/&gt;Decision: 🙈
    B--&gt;&gt;B: Injects Behavior
    deactivate B
    B-&gt;&gt;+D: Invokes
    D-&gt;&gt;-B: Returns result
    B-&gt;&gt;P: Returns result
    P-&gt;&gt;C: Returns result
</code></pre>
<h2 id="anti-patterns">Anti-patterns</h2>
<h3 id="injecting-delay">Injecting delay</h3>
<p>❌ DON'T</p>
<p>Use behavior strategies to inject delays.</p>
<p>✅ DO</p>
<p>Use the latency chaos instead as the <a href="latency.html"><code>LatencyChaosStrategy</code></a> already correctly handles synchronous/asynchronous delay executions, cancellations, etc.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/App-vNext/Polly/blob/main/docs/chaos/behavior.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
